PARTE 12 â€“ Web Admin en React: Monitoreo en Tiempo Real con WebSocket

Este mÃ³dulo permite visualizar en vivo lo que hacen los usuarios mÃ³viles: ubicaciÃ³n, alertas, check-ins, formularios, etc. Se construye sobre WebSockets para obtener eventos push en tiempo real sin necesidad de hacer polling.

ğŸ”Œ 12.1 â€“ Â¿QuÃ© es WebSocket y cÃ³mo se usa?

Es un canal de comunicaciÃ³n permanente entre cliente y servidor.

A diferencia de HTTP, donde el cliente pregunta, aquÃ­ el servidor puede emitir eventos automÃ¡ticamente.

En React, usamos socket.io-client.

En NestJS, usamos @nestjs/websockets + socket.io.

ğŸ§  12.2 â€“ Ejemplo PrÃ¡ctico de Uso
ğŸ”” Escenario:

Un usuario hace check-in en el campo

Su app mÃ³vil envÃ­a ubicaciÃ³n + info a /api/checkin

El backend (NestJS) emite evento WebSocket

Todos los supervisores conectados en el panel web lo ven al instante

âš›ï¸ 12.3 â€“ CÃ³digo React (cliente WebSocket)
ğŸ“¦ Instalar
npm install socket.io-client

ğŸ§¬ ConexiÃ³n
import { io } from 'socket.io-client';

const socket = io('https://api.tuservidor.com', {
  path: '/ws/',
  auth: { token: 'Bearer ' + accessToken },
});

ğŸ”” Escuchar eventos
useEffect(() => {
  socket.on('nuevo-checkin', (data) => {
    console.log('Nuevo check-in:', data);
    // Actualiza mapa o tabla en tiempo real
    setUbicaciones((prev) => [...prev, data]);
  });

  return () => {
    socket.disconnect();
  };
}, []);

ğŸª„ 12.4 â€“ Backend NestJS (/gateway/checkin.gateway.ts)
ğŸ“¦ ConfiguraciÃ³n WebSocket
@WebSocketGateway({ namespace: 'ws', cors: true })
export class CheckinGateway {
  @WebSocketServer()
  server: Server;

  emitirNuevoCheckin(data: any) {
    this.server.emit('nuevo-checkin', data);
  }
}

ğŸ¯ Llamado desde servicio check-in
await this.checkinGateway.emitirNuevoCheckin({
  id_usuario,
  nombre: 'Juan PÃ©rez',
  lat,
  lng,
  hora: new Date().toISOString(),
});

ğŸ—ºï¸ 12.5 â€“ VisualizaciÃ³n en mapa React
<Marker position={[lat, lng]} icon={iconoCheckin}>
  <Popup>{usuario} - {hora}</Popup>
</Marker>


Usa librerÃ­as como react-leaflet, google-maps-react o maplibre.

Cada evento WebSocket recibido actualiza un nuevo marcador.

Se puede mostrar:

Color por estado (verde: checkin, rojo: alerta)

Ãšltima ubicaciÃ³n

Trayectoria completa

ğŸ›¡ï¸ 12.6 â€“ Seguridad

Cada conexiÃ³n WebSocket exige token JWT

Se puede limitar quÃ© eventos recibe cada rol

Conexiones invÃ¡lidas son rechazadas en handleConnection del gateway