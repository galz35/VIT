PARTE 19 â€“ Cierre de Ciclo por Visita: Check-Out, Firma y ConfirmaciÃ³n Final

Este mÃ³dulo asegura que cada visita tenga un cierre completo y validado, registrando ubicaciÃ³n, hora, observaciones y firma del cliente.

ğŸ” 19.1 â€“ Flujo Completo de Visita

Usuario visualiza su tarea del dÃ­a.

Llega al cliente â†’ hace Check-in (geovalidado).

Llena el formulario dinÃ¡mico asignado.

Adjunta evidencia (foto, firma, comentarios).

Realiza Check-out para cerrar la visita.

ğŸ“± 19.2 â€“ Flutter: Componente de Check-out
Elementos requeridos en pantalla:

Firma del cliente (signature)

Campo de observaciones finales

Foto final (opcional/forzada)

BotÃ³n "Finalizar Visita"

TextFormField(
  decoration: InputDecoration(labelText: 'Observaciones'),
  maxLines: 3,
  onSaved: (val) => observaciones = val,
);

Signature(controller: signatureController, height: 200);

ğŸ“„ 19.3 â€“ Estructura de Check-out (SQLite)

Tabla: checkouts_local

Campo	Tipo
id	INT PK
tarea_id	UUID
lat / lng	REAL
firma_path	TEXT
observacion	TEXT
foto_path	TEXT
timestamp	TEXT
estado	'PENDIENTE' / 'ENVIADO'
ğŸŒ 19.4 â€“ EnvÃ­o al Backend

POST /api/checkouts

{
  "tarea_id": "TRX0928",
  "lat": -12.044,
  "lng": -77.032,
  "timestamp": "2026-02-11T16:30:00Z",
  "firma": "firma_00092.png",
  "foto": "foto_final.png",
  "observacion": "Cliente satisfecho con entrega"
}

ğŸ–¼ï¸ 19.5 â€“ Vista Web: Detalle de Visita
Panel lateral

ğŸ“Œ Cliente + ubicaciÃ³n

ğŸ“… Fecha y hora

âœ… Check-in y Check-out con mapa

ğŸ“ Formulario completado

âœï¸ Firma visible

ğŸ“· Foto adjunta

ğŸ‘ï¸ Observaciones

ğŸ§® 19.6 â€“ Validaciones al cerrar

No puede hacer check-out sin check-in

Si falta firma y es obligatoria â†’ bloquea

Si estÃ¡ fuera de zona â†’ muestra advertencia o fuerza justificaciÃ³n

Al completar: se marca tarea.estado = finalizada

ğŸ“Š 19.7 â€“ MÃ©tricas extraÃ­das

Tiempo total en visita (checkout - checkin)

Firma sÃ­/no

UbicaciÃ³n inicial y final (trayecto)

Calidad de visita (basado en formulario y alertas)