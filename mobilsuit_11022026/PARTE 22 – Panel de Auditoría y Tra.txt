PARTE 22 â€“ Panel de AuditorÃ­a y Trazabilidad

Permite seguir cada evento relevante del sistema: sincronizaciones, errores, modificaciones de datos, cambios en tareas o formularios, etc.

ğŸ“‘ 22.1 â€“ Tabla: auditoria
Campo	Tipo	DescripciÃ³n
id	UUID	ID Ãºnico
usuario_id	UUID	QuiÃ©n ejecutÃ³ el evento
tipo_evento	TEXT	'modificacion', 'sync_error', etc.
entidad	TEXT	'tarea', 'usuario', 'formulario'
entidad_id	UUID	ID del objeto afectado
detalle	TEXT	DescripciÃ³n del cambio / error
ip	TEXT	IP o device id
timestamp	TEXT	Fecha del evento (ISO 8601)
ğŸ§  22.2 â€“ Eventos auditables
Evento	Tipo
ModificaciÃ³n de usuario	modificacion
Nueva tarea asignada	creacion
Respuesta de formulario editada	modificacion
SincronizaciÃ³n fallida	sync_error
Cierre de visita fuera de zona	alerta
Login desde nuevo dispositivo	evento_seguridad
ğŸ“¥ 22.3 â€“ Captura automÃ¡tica

Decorador NestJS: @Auditable('modificacion', 'usuario')

Middleware global registra:

Usuario actual (por token)

Entidad y acciÃ³n

Fecha y IP

En mobile, si ocurre error crÃ­tico o alerta â†’ tambiÃ©n se registra

ğŸ–¥ï¸ 22.4 â€“ Panel Web: Vista /admin/auditoria

Tabla paginada por:

Fecha

Usuario

Tipo de evento

Entidad

Filtros:

Rango de fechas

ID entidad

IP

Modal con detalle completo

ğŸ” 22.5 â€“ Seguridad

Solo accesible para rol admin

Campos sensibles como detalle pueden ocultar datos con *** si son tokens o claves

Se almacena inmutable (sin UPDATE ni DELETE)

Â¿Avanzamos con la Parte 23 â€“ Sistema avanzado de roles y permisos por mÃ³dulo/pantalla/endpoints?