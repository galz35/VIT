Tablas sqflite Flutter â€“ Almacenamiento Offline
ğŸ“ tracking_local

Registra puntos GPS mientras no hay conexiÃ³n.

CREATE TABLE tracking_local (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  id_usuario TEXT,
  lat REAL,
  lng REAL,
  precision INTEGER,
  velocidad REAL,
  bateria INTEGER,
  timestamp TEXT,
  origen TEXT DEFAULT 'background', -- o 'manual'
  estado TEXT DEFAULT 'PENDIENTE' -- PENDIENTE / ENVIADO / ERROR
);

âœ… checkins_local

Check-ins realizados sin conexiÃ³n.

CREATE TABLE checkins_local (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  id_actividad TEXT,
  lat REAL,
  lng REAL,
  bateria INTEGER,
  foto_local TEXT,
  timestamp TEXT,
  estado TEXT DEFAULT 'PENDIENTE'
);

ğŸ“ formularios_local

Respuestas completas de formularios.

CREATE TABLE formularios_local (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  id_formulario TEXT,
  id_actividad TEXT,
  json_respuestas TEXT,
  firma_base64 TEXT,
  timestamp TEXT,
  estado TEXT DEFAULT 'PENDIENTE'
);

ğŸ“ archivos_local

Archivos (fotos, firmas) pendientes de subida.

CREATE TABLE archivos_local (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  ruta_local TEXT,
  tipo TEXT, -- 'foto', 'firma'
  entidad_origen TEXT, -- 'formulario', 'checkin'
  id_origen TEXT,
  timestamp TEXT,
  estado TEXT DEFAULT 'PENDIENTE'
);

ğŸ”„ sync_log

Registro de intentos de sincronizaciÃ³n.

CREATE TABLE sync_log (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  modulo TEXT, -- 'tracking', 'checkin', etc.
  id_objeto TEXT,
  resultado TEXT,
  mensaje_error TEXT,
  fecha_sync TEXT
);

ğŸ› ï¸ Extras recomendadas
Tabla: config_local

Guarda preferencias del dispositivo.

CREATE TABLE config_local (
  clave TEXT PRIMARY KEY,
  valor TEXT
);


Ejemplo:

intervalo_tracking = 60

ultimo_sync = "2026-02-11T19:34"

GestiÃ³n de estado y sincronizaciÃ³n

Cada tabla tiene estado que puede ser:

"PENDIENTE"

"ENVIADO"

"ERROR"

El servicio SyncService recorre solo las filas con "PENDIENTE" o "ERROR".

Â¿QuerÃ©s que te entregue el cÃ³digo Flutter para inicializar estas tablas con sqflite y mÃ©todos DAO para insert/update/sync?

pero eso solo coordenada pero solo eso hace ese sistema para que solo tenga eso el sqlite?

Correcto. Si solo guardÃ¡ramos coordenadas, serÃ­a insuficiente.

ğŸ§  El sistema no solo guarda coordenadas. La arquitectura offline en sqflite cubre TODO lo necesario para que la app mÃ³vil funcione completamente sin conexiÃ³n.

AquÃ­ va un resumen por mÃ³dulo:

ğŸ—‚ï¸ Â¿QuÃ© guarda sqflite offline?
MÃ³dulo	Â¿QuÃ© se guarda?	Tabla local
ğŸ“ Tracking GPS	Coordenadas + baterÃ­a + velocidad	tracking_local
âœ… Check-in	Coordenadas, foto, ID de tarea	checkins_local
ğŸ“¤ Check-out	Observaciones, coordenadas	checkouts_local (puede agregarse si lo usÃ¡s separado)
ğŸ“ Formularios	JSON de respuestas + firma	formularios_local
ğŸ“ Archivos	Ruta local de imÃ¡genes/firma	archivos_local
ğŸš¨ Alertas	Tipo + mensaje + coordenadas	alertas_local
ğŸ“… Tareas asignadas	Lista de visitas del dÃ­a (sincronizadas desde backend)	tareas_cache
ğŸ‘¤ Usuario actual	Info login actual (token, nombre, rol)	usuario_actual o config_local
ğŸ” Â¿QuÃ© hace el SyncService?

Cada X minutos o al reconectarse:

Lee las tablas locales con estado = 'PENDIENTE'

EnvÃ­a a la API los datos pendientes

Si recibe 200 OK, borra o marca como ENVIADO

Si hay error (timeout, 500), marca como ERROR para reintentar

âœ… Resultado: Offline total

Puede hacer check-in, formularios, alertas, tracking, adjuntos sin conexiÃ³n.

El usuario solo necesita conectarse al final del dÃ­a para sincronizar.