PARTE 2.1 â€“ Flujos Funcionales: App Flutter (Campo)

Esta secciÃ³n cubre los flujos crÃ­ticos del colaborador en campo, que serÃ¡n implementados en la app Flutter.

ğŸ“† 2.1.1 â€“ Inicio de Jornada
Objetivo:

Sincronizar tareas asignadas y activar tracking.

Flujo:

Login con usuario + contraseÃ±a (JWT + refresh)

ValidaciÃ³n de dispositivo (opcional: device_id)

Se ejecuta SyncManager:

Descarga tareas asignadas

Descarga formularios asignables

Sincroniza tracking pendiente

App activa TrackingService en background

ğŸ“ 2.1.2 â€“ Check-in / Check-out
Objetivo:

Validar que el colaborador estÃ¡ presente en el lugar asignado.

Pantalla: TareaDetallePage
Elemento	Comportamiento
BotÃ³n â€œCheck-inâ€	Solo disponible si estÃ¡ dentro del radio del cliente
Validaciones	GPS activo, precisiÃ³n < 30m, baterÃ­a suficiente
Captura	lat/lng, nivel de baterÃ­a, timestamp, distancia real
Adjuntos opcionales	Foto selfie / firma digital
LÃ³gica:
if (distancia(punto_actual, cliente) <= cliente.radio) {
  habilitarBotonCheckIn()
}

ğŸ“ 2.1.3 â€“ Formulario DinÃ¡mico
Objetivo:

Permitir que el colaborador complete formularios definidos desde el backend.

Pantalla: FormularioPage
CaracterÃ­stica	ImplementaciÃ³n
UI dinÃ¡mica	JSON recibido vÃ­a API, parseado a FormBuilder
Tipos de campo	Texto, numÃ©rico, selecciÃ³n, fecha, foto, firma, audio
Validaciones	Requerido, tipo, condiciones dependientes
Adjuntos	Guardados en carpeta local hasta subirlos
Firma	Captura de trazo y conversiÃ³n a PNG base64
JSON ejemplo:
{
  "form_id": "rutinaria_v1",
  "campos": [
    {"id": "c1", "tipo": "texto", "etiqueta": "ObservaciÃ³n", "requerido": true},
    {"id": "c2", "tipo": "foto", "etiqueta": "Foto del equipo"},
    {"id": "c3", "tipo": "firma", "etiqueta": "Firma del cliente"}
  ]
}

ğŸ›°ï¸ 2.1.4 â€“ Tracking en Segundo Plano
Objetivo:

Registrar recorrido GPS sin intervenciÃ³n del usuario.

Servicio: TrackingService (ejecuta cada 30 seg â€“ 5 min)
Campo	Valor
Recolecta	lat, lng, velocidad, timestamp, precisiÃ³n, origen
Guarda en	tracking_points local
Sincroniza	Cuando hay conexiÃ³n, en batch
Control de energÃ­a	Se pausa si baterÃ­a < 15% (modo configurable)
ğŸ”” 2.1.5 â€“ BotÃ³n de PÃ¡nico
Objetivo:

Enviar una alerta inmediata con ubicaciÃ³n.

Pantalla: EmergenciaPage

BotÃ³n visible desde menÃº principal o splash flotante

Al presionar:

Captura ubicaciÃ³n

OpciÃ³n de texto/motivo

EnvÃ­a a /api/alerta/panico con prioridad

En Web Admin aparece en panel de alertas

â˜ï¸ 2.1.6 â€“ SincronizaciÃ³n Manual
Objetivo:

Permitir al usuario forzar sincronizaciÃ³n de tareas, formularios, tracking y adjuntos.

Pantalla: SincronizarPage

Botones:

ğŸ” Sincronizar tareas

ğŸ“¤ Enviar formularios pendientes

ğŸ“ Enviar tracking

ğŸ§¾ Subir adjuntos

Muestra:

Contador de pendientes

Estado (âœ… Enviado, âŒ FallÃ³, â³ En cola)

ğŸ§¾ 2.1.7 â€“ Historial y Reportes

Pantalla: HistorialPage

Lista de tareas completadas (local + remoto)

Indicadores:

Tiempo en sitio

Distancia recorrida

Formulario enviado (âœ… / âŒ)

Filtro por dÃ­a/semana

ğŸ“² 2.1.8 â€“ Notificaciones Push

Via FCM:

Nueva tarea asignada

Recordatorio de visita no hecha

Alerta emitida por otro usuario

Mensaje interno / chat

Â¿Avanzo con la Parte 2.2 (Flujos Funcionales: Panel Web en React â€“ asignaciÃ³n, builder, mapa, reportes)?