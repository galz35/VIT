PARTE 23 â€“ Sistema Avanzado de Roles y Permisos

Control granular de accesos en todo el ecosistema (mÃ³vil, web, API) por mÃ³dulo, acciÃ³n, campo y visibilidad.

ğŸ·ï¸ 23.1 â€“ Roles Base
Rol	Acceso
admin	Control total: usuarios, zonas, reportes, etc.
supervisor	GestiÃ³n de tareas, formularios y monitoreo general
tecnico	Acceso a tareas asignadas, check-in, formularios
auditor	Solo lectura: reportes y actividades
soporte	Ver logs, auditorÃ­a, no modifica nada
ğŸ§± 23.2 â€“ Tabla: permisos
Campo	Tipo	DescripciÃ³n
id	UUID	Clave Ãºnica
rol	TEXT	Rol afectado
modulo	TEXT	Ej. usuarios, tareas, alertas, etc.
accion	TEXT	ver, crear, editar, eliminar
permitido	BOOL	true/false

Este sistema permite crear roles personalizados o hÃ­bridos si se requiere.

ğŸ” 23.3 â€“ Middleware NestJS (PermissionGuard)
@UseGuards(JwtAuthGuard, PermissionGuard('usuarios', 'editar'))
@Put('/usuarios/:id')


Se extrae el rol del JWT

Se consulta si ese rol puede ejecutar accion sobre modulo

Si no tiene permiso â†’ 403 Forbidden

âš›ï¸ 23.4 â€“ React Web: UI Adaptativa

MenÃºs, botones y vistas se ocultan o bloquean segÃºn permisos:

{hasPermiso('usuarios', 'crear') && <BotonCrearUsuario />}


Componente AccessControl:

<AccessControl modulo="reportes" accion="ver">
  <ReportesPanel />
</AccessControl>

ğŸ“± 23.5 â€“ Flutter App: Permisos mÃ³viles

Cada respuesta del login trae el rol y lista de permisos en cache:

{
  "rol": "tecnico",
  "permisos": [
    { "modulo": "formularios", "accion": "ver", "permitido": true },
    ...
  ]
}


El cÃ³digo Flutter evalÃºa si mostrar opciones (ej. botÃ³n de alerta, firma, repetir visita)

ğŸ§ª 23.6 â€“ Validaciones cruzadas

Backend nunca confÃ­a en el frontend.

Aunque el botÃ³n estÃ© oculto, toda acciÃ³n se vuelve a validar en la API.

Si cambia el rol â†’ la sesiÃ³n expira y fuerza re-login (o recarga permisos con /api/mis-permisos).