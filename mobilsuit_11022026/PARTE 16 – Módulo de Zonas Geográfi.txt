PARTE 16 â€“ MÃ³dulo de Zonas GeogrÃ¡ficas, ValidaciÃ³n de Radio y AsignaciÃ³n GPS

Este mÃ³dulo permite validar que los check-ins/formularios se realicen dentro del Ã¡rea esperada, asignar tareas automÃ¡ticamente por zona y visualizar todo geogrÃ¡ficamente.

ğŸ“ 16.1 â€“ DefiniciÃ³n de Zonas
Tabla: zonas
Campo	Tipo	DescripciÃ³n
id_zona	UUID	Identificador Ãºnico
nombre	TEXT	Nombre legible (ej. Zona Norte)
poligono	JSON	Array de coordenadas [{lat, lng}]
color	TEXT	Para visualizaciÃ³n
activo	BOOL	Habilitada o no
Ejemplo de poligono:
[
  {"lat": -12.06, "lng": -77.05},
  {"lat": -12.07, "lng": -77.04},
  {"lat": -12.08, "lng": -77.06}
]

ğŸ§  16.2 â€“ ValidaciÃ³n GPS en Check-In (Backend)
function estaEnZona(lat: number, lng: number, zona: Zona): boolean {
  return pointInPolygon({ lat, lng }, zona.poligono);
}


Si no estÃ¡ dentro del Ã¡rea:

Se registra como alerta

Se marca como â€œfuera de zonaâ€

Opcional: bloquear envÃ­o o permitir con justificaciÃ³n

ğŸ“¦ 16.3 â€“ Flutter: ValidaciÃ³n local

Antes de permitir check-in, se verifica con zona precargada

Si distancia > radio_max, se muestra advertencia

Si se permite continuar â†’ se guarda como â€œcheckin fuera de zonaâ€

ğŸ§  16.4 â€“ AsignaciÃ³n automÃ¡tica por zona
Backend

Cada cliente tiene coordenadas

Se recorre cada zona y se evalÃºa:

if (pointInPolygon(cliente.lat, cliente.lng, zona.poligono)) {
  cliente.zona = zona.id;
}


Al crear tareas por lote, se filtra por zona

ğŸ—ºï¸ 16.5 â€“ VisualizaciÃ³n en React Web

Se usa react-leaflet o maplibre

Zonas pintadas como Polygon

Check-ins y usuarios en tiempo real como Marker

Colores por:

Dentro de zona âœ… (verde)

Fuera de zona âš ï¸ (rojo)

Hover: cliente â†’ nombre, direcciÃ³n, zona

ğŸš¨ 16.6 â€“ Alerta automÃ¡tica si estÃ¡ fuera del rango

Se registra en alertas_local:

Campo	Valor
tipo	'fuera_zona'
mensaje	"Check-in fuera del radio"
lat/lng	Coordenadas reales
timestamp	ISO 8601
estado	'PENDIENTE'	