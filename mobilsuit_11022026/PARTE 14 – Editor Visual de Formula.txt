PARTE 14 â€“ Editor Visual de Formularios DinÃ¡micos (Web) + Renderizado en Flutter

Permite a supervisores crear y administrar formularios personalizados desde el panel web, que luego se renderizan dinÃ¡micamente en la app mÃ³vil.

âš™ï¸ 14.1 â€“ Flujo General

Admin crea formulario desde web (drag & drop o JSON).

Se guarda en base de datos como estructura JSON.

Flutter interpreta esa estructura y renderiza el formulario.

Las respuestas se almacenan localmente (sqflite) y luego se sincronizan.

ğŸ§± 14.2 â€“ Estructura JSON del Formulario
{
  "id": "form_001",
  "titulo": "Encuesta de Cliente",
  "campos": [
    {
      "tipo": "texto",
      "clave": "nombre_cliente",
      "label": "Nombre del Cliente",
      "requerido": true
    },
    {
      "tipo": "numero",
      "clave": "edad",
      "label": "Edad",
      "min": 18,
      "max": 99
    },
    {
      "tipo": "opciones",
      "clave": "satisfaccion",
      "label": "Nivel de SatisfacciÃ³n",
      "opciones": ["Alta", "Media", "Baja"],
      "requerido": true
    },
    {
      "tipo": "firma",
      "clave": "firma_cliente",
      "label": "Firma"
    }
  ]
}

âš›ï¸ 14.3 â€“ Editor Web (React)
ğŸ”§ LibrerÃ­as

react-hook-form + zod

dnd-kit o react-beautiful-dnd (drag & drop)

react-json-view (para validaciÃ³n directa)

âœ¨ Funciones

Agregar campo (texto, nÃºmero, opciones, firma, fecha, imagen)

Cambiar orden de campos

Previsualizar formulario renderizado

Validar campos requeridos

Guardar JSON en /api/formularios/definir

ğŸ”§ 14.4 â€“ Backend NestJS: Endpoints
Endpoint	MÃ©todo	DescripciÃ³n
/api/formularios/definir	POST	Guarda o actualiza JSON
/api/formularios/asignar	POST	Asocia un formulario a una tarea o usuario
/api/formularios/:id	GET	Devuelve JSON para render Flutter
/api/respuestas	POST	Recibe respuestas llenadas
ğŸ“± 14.5 â€“ Flutter: Render dinÃ¡mico del formulario
ğŸ“¦ LibrerÃ­as
dependencies:
  dynamic_widget: ^1.1.0
  signature: ^5.2.1
  flutter_form_builder: ^9.1.1

ğŸ“Œ LÃ³gica

El app recibe JSON desde API o SQLite.

Recorre campos[] y construye widgets:

TextFormField, DropdownButtonFormField, Signature, etc.

Al enviar, crea un Map<String, dynamic> con todas las respuestas.

Guarda el resultado como json_respuestas en formularios_local.

ğŸ§ª ValidaciÃ³n

Si requerido = true, se valida en el FormBuilder

Campos especiales como firma o foto deben tener captura vÃ¡lida

âœ… Ejemplo de campo Flutter generado
if (campo.tipo == 'texto') {
  return TextFormField(
    decoration: InputDecoration(labelText: campo.label),
    validator: campo.requerido ? Validators.required : null,
    onSaved: (value) => respuestas[campo.clave] = value,
  );
}