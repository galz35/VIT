1. üß≠ M√≥dulo de Visita Geolocalizada
A. Tabla nueva: visitas_clientes
Campo	Tipo	Descripci√≥n
id_visita	UUID	Clave primaria
id_cliente	UUID	FK a tabla clientes
id_usuario	UUID	FK a tabla usuarios
lat_inicio	FLOAT	Coordenada al llegar
lng_inicio	FLOAT	
lat_fin	FLOAT	Coordenada al salir (opcional)
lng_fin	FLOAT	
inicio_ts	DATETIME	Fecha y hora de check-in
fin_ts	DATETIME	Check-out (si aplica)
estado	TEXT	PENDIENTE / EN CURSO / FINALIZADA
comentario	TEXT	Observaciones generales
firma_path	TEXT	Ruta a la firma opcional
foto_path	TEXT	Foto tomada en sitio (WebP)

Si ya us√°s agenda_dia, puede vincularse v√≠a id_agenda.

B. Stored Procedure: sp_RegistrarVisitaCliente
CREATE PROCEDURE sp_RegistrarVisitaCliente
  @id_cliente UNIQUEIDENTIFIER,
  @id_usuario UNIQUEIDENTIFIER,
  @lat FLOAT,
  @lng FLOAT,
  @comentario NVARCHAR(MAX)
AS
BEGIN
  -- valida proximidad con punto cliente
  -- inserta en visitas_clientes
END

2. üì± Flutter ‚Äì Pantalla ‚ÄúVisita Cliente‚Äù
Nueva ruta: /visita/:id_cliente

Componentes:

Mapa (Google Maps) con c√≠rculo de validaci√≥n.

Bot√≥n "Check-in"

Campo observaci√≥n + firma + foto

Bot√≥n "Finalizar visita"

Se guarda primero local en SQLite (modo offline), luego sincroniza.

3. üåê Web (React) ‚Äì Panel de Visitas
Ruta nueva: /visitas
Funciones:

Lista de visitas (filtros por cliente, fecha, estado)

Mapa de ruta recorrida (si hay tracking activo)

Vista de check-in/check-out + firma y foto

Estado de sincronizaci√≥n

4. üì∂ Sincronizaci√≥n Flutter

Agreg√° l√≥gica en tu SyncService:

await VisitasSync().sync();


Usa tabla local visitas_local (estructura similar a checkins o formularios) con:

estado = PENDIENTE

Al sincronizar exitosamente ‚Üí marcar como ENVIADO

5. üß™ Nuevas Validaciones

No permitir finalizar visita si no se hizo check-in.

Validar distancia m√°xima (100m) al punto GPS del cliente.

Alertar si coordenadas est√°n vac√≠as.

Adjuntar firma/foto si est√° marcado como obligatorio en el tipo de visita.

6. üñºÔ∏è Evidencia Multimedia (WebP)

Asegurate de:

Comprimir imagen a .webp en Flutter antes de guardar.

Backend debe validar image/webp y guardar en carpeta /evidencia/visitas/yyyy/mm/.

Con esto ya tendr√≠as la funcionalidad de Mobile Suit Case clonada al 100%, pero fusionada elegantemente con tu sistema Planner-EF.