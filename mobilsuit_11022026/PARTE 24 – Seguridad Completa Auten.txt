PARTE 24 â€“ Seguridad Completa: AutenticaciÃ³n, Tokens, ExpiraciÃ³n y Control de Accesos

Este mÃ³dulo implementa un sistema robusto para proteger sesiones, datos sensibles, identidades y accesos desde Flutter, React y APIs NestJS.

ğŸ” 24.1 â€“ Tipos de autenticaciÃ³n
Plataforma	MÃ©todo	Detalle
Web (React)	JWT + Refresh	Token corto + refresh token seguro en cookie httpOnly
App (Flutter)	JWT persistido	Guardado en flutter_secure_storage con control de expiraciÃ³n
API	Bearer Token	Protegido con roles, permisos, filtros IP
ğŸ§± 24.2 â€“ Tabla: usuarios
Campo	Tipo	DescripciÃ³n
id_usuario	UUID	ID Ãºnico
carnet	TEXT	Identificador Ãºnico fÃ­sico
nombre	TEXT	Nombre visible
correo	TEXT	Login
password	TEXT	Hash (bcrypt)
rol	TEXT	Rol del sistema
activo	BOOL	true/false
ğŸ§  24.3 â€“ AutenticaciÃ³n JWT (NestJS)
Tokens

Access token: expira en 15 minutos

Refresh token: 7 dÃ­as (usado solo en web)

Firmados con claves privadas (RSA preferible)

Login
POST /api/auth/login


Verifica correo + password (hash bcrypt)

Devuelve access_token + refresh_token (si es web)

ğŸ“± 24.4 â€“ Flutter: Manejo de sesiÃ³n

Token guardado en flutter_secure_storage

Interceptor DIO agrega el Authorization: Bearer ...

Si token expira â†’ intento de refresh silencioso

if (response.statusCode == 401 && hayRefreshToken) {
  await renovarToken();
  repetirRequestFallido();
}

ğŸ–¥ï¸ 24.5 â€“ React: SesiÃ³n protegida

Refresh token en cookie httpOnly

access_token en memoria (no en localStorage)

Axios incluye token automÃ¡ticamente

ğŸ›¡ï¸ 24.6 â€“ Controles de seguridad adicionales
Control	DescripciÃ³n
ğŸ” RotaciÃ³n diaria de tokens	Tokens se invalidan si cambia contraseÃ±a o rol
ğŸ“µ Bloqueo de IP	Lista blanca en producciÃ³n (env configurado)
ğŸ“… ExpiraciÃ³n por inactividad	SesiÃ³n web expira tras 30 min sin interacciÃ³n
ğŸ§ª Hash de payload crÃ­tico	ValidaciÃ³n de integridad de formularios enviados
ğŸ“ ValidaciÃ³n de ubicaciÃ³n	Login mÃ³vil solo dentro de zona (opcional)
ğŸ§ª 24.7 â€“ AuditorÃ­a de acceso

Cada login/logout queda en auditoria

Si login falla (intentos repetidos) â†’ alerta

Login desde nuevo dispositivo â†’ notificaciÃ³n web/email