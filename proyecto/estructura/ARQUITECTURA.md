# ๐๏ธ ARQUITECTURA DEL SISTEMA

**Proyecto:** MOMENTUS  
**Versiรณn:** 2.0

---

## ๐ Diagrama General

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      USUARIOS                                    โ
โ         (Navegador Web / Mรณvil / Desktop PWA)                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    FRONTEND (React PWA)                          โ
โ                    http://localhost:5173                         โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  โ  React 18 + TypeScript + Vite + TailwindCSS                 โโ
โ  โ  โโโโโโโโโโโ โโโโโโโโโโโ โโโโโโโโโโโ โโโโโโโโโโโ           โโ
โ  โ  โ Pages   โ โComponentsโ โServices โ โ Context โ           โโ
โ  โ  โ (56)    โ โ  (80+)  โ โ  (10)   โ โ  (5)    โ           โโ
โ  โ  โโโโโโโโโโโ โโโโโโโโโโโ โโโโโโโโโโโ โโโโโโโโโโโ           โโ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ HTTP/REST + JWT
                              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     BACKEND (NestJS API)                         โ
โ                    http://localhost:3000/api                     โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  โ  NestJS 10 + TypeScript + TypeORM                           โโ
โ  โ  โโโโโโโโโโโ โโโโโโโโโโโ โโโโโโโโโโโ โโโโโโโโโโโ           โโ
โ  โ  โ  AUTH   โ โ CLARITY โ โ ACCESO  โ โPLANNING โ           โโ
โ  โ  โ Module  โ โ Module  โ โ Module  โ โ Module  โ           โโ
โ  โ  โโโโโโโโโโโ โโโโโโโโโโโ โโโโโโโโโโโ โโโโโโโโโโโ           โโ
โ  โ  โโโโโโโโโโโ โโโโโโโโโโโ                                    โโ
โ  โ  โ  ADMIN  โ โ COMMON  โ                                    โโ
โ  โ  โ Module  โ โ Module  โ                                    โโ
โ  โ  โโโโโโโโโโโ โโโโโโโโโโโ                                    โโ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ TypeORM
                              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    BASE DE DATOS                                 โ
โ                    PostgreSQL 15                                 โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  โ  23 Tablas principales                                      โโ
โ  โ  p_Usuarios, p_Tareas, p_empleados, p_Proyectos, etc.      โโ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ Estructura de Carpetas

### Backend (`/backend`)
```
backend/
โโโ src/
โ   โโโ auth/              # Autenticaciรณn JWT
โ   โ   โโโ auth.controller.ts
โ   โ   โโโ auth.service.ts
โ   โ   โโโ dto/
โ   โ   โโโ entities/
โ   โ       โโโ usuario.entity.ts
โ   โ       โโโ usuario-credenciales.entity.ts
โ   โ       โโโ rol.entity.ts
โ   โ
โ   โโโ clarity/           # Core de productividad
โ   โ   โโโ clarity.controller.ts
โ   โ   โโโ clarity.service.ts
โ   โ   โโโ tasks.service.ts
โ   โ   โโโ foco.service.ts
โ   โ   โโโ reports.service.ts
โ   โ   โโโ entities/
โ   โ       โโโ tarea.entity.ts
โ   โ       โโโ bloqueo.entity.ts
โ   โ       โโโ checkin.entity.ts
โ   โ       โโโ foco-diario.entity.ts
โ   โ
โ   โโโ acceso/            # Control de acceso
โ   โ   โโโ acceso.controller.ts
โ   โ   โโโ acceso.service.ts
โ   โ   โโโ import.controller.ts
โ   โ   โโโ import.service.ts
โ   โ   โโโ visibilidad.controller.ts
โ   โ   โโโ visibilidad.service.ts
โ   โ   โโโ entities/
โ   โ       โโโ empleado.entity.ts
โ   โ       โโโ permiso-area.entity.ts
โ   โ       โโโ delegacion-visibilidad.entity.ts
โ   โ
โ   โโโ planning/          # Planificaciรณn
โ   โ   โโโ planning.controller.ts
โ   โ   โโโ planning.service.ts
โ   โ
โ   โโโ admin/             # Administraciรณn
โ   โ   โโโ admin.controller.ts
โ   โ
โ   โโโ common/            # Compartido
โ       โโโ interceptors/
โ       โโโ filters/
โ       โโโ entities/
โ
โโโ package.json
โโโ tsconfig.json
```

### Frontend (`/clarity-pwa`)
```
clarity-pwa/
โโโ src/
โ   โโโ pages/             # 56 pรกginas
โ   โ   โโโ Hoy/           # Mi Dรญa y componentes
โ   โ   โโโ Equipo/        # Vistas de equipo
โ   โ   โโโ Planning/      # Planificaciรณn
โ   โ   โโโ Admin/         # Administraciรณn
โ   โ   โโโ ...
โ   โ
โ   โโโ components/        # Componentes reutilizables
โ   โ   โโโ layout/        # Sidebar, Header
โ   โ   โโโ ui/            # Botones, Cards, etc
โ   โ
โ   โโโ services/          # Servicios API
โ   โ   โโโ auth.service.ts
โ   โ   โโโ clarity.service.ts
โ   โ   โโโ acceso.service.ts
โ   โ
โ   โโโ context/           # Estados globales
โ   โ   โโโ AuthContext.tsx
โ   โ
โ   โโโ types/             # Tipado TypeScript
โ       โโโ modelos.ts
โ       โโโ acceso.ts
โ
โโโ package.json
โโโ vite.config.ts
```

---

## ๐ Mรณdulos del Backend

| Mรณdulo | Ruta Base | Funciรณn |
|--------|-----------|---------|
| **AUTH** | `/auth` | Login, refresh tokens |
| **CLARITY** | `/` | Tareas, check-ins, foco |
| **ACCESO** | `/acceso` | Empleados, permisos |
| **VISIBILIDAD** | `/visibilidad` | Reglas de acceso |
| **PLANNING** | `/planning` | Solicitudes de cambio |
| **ADMIN** | `/admin` | Usuarios, roles, logs |

---

## ๐ Flujo de Autenticaciรณn

```
1. Usuario ingresa correo + contraseรฑa
           โ
           โผ
2. POST /auth/login
           โ
           โผ
3. Servidor valida credenciales
           โ
           โผ
4. Retorna: { access_token, refresh_token, user }
           โ
           โผ
5. Frontend guarda tokens en localStorage
           โ
           โผ
6. Cada peticiรณn incluye: Authorization: Bearer <token>
           โ
           โผ
7. Cuando expira (1h), usa refresh_token para renovar
```

---

## ๐ก๏ธ Capas de Seguridad

1. **JWT Guard:** Valida token en cada peticiรณn
2. **Roles Guard:** Verifica rol del usuario (Admin, etc)
3. **Validaciรณn DTO:** class-validator en cada entrada
4. **Transform Interceptor:** Formato de respuesta consistente

---

*รltima actualizaciรณn: 14 de Enero 2026*
